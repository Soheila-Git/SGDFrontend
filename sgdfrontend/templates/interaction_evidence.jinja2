<!DOCTYPE html>

<title>{{display_name}} Interactions</title>

{% extends "templates/global_layout.jinja2" %}


{% block body %}

<div id="center_title" class="row">
	<h2><span class="gene_name">{{display_name}}/{{format_name}}</span> Physical and Genetic Interactions  <a href="http://www.yeastgenome.org/help/interaction.html" name="top" class="help"><img src="http://www.yeastgenome.org/images/icon_help_circle_dark.png" alt="Help"></a></h2>
</div>


<!-- Includes tabs.html into template -->
{% include "templates/tabs.jinja2" %}

<!-- Docs nav
================================================== -->
<div class="row">
	<nav id="sidebar" class="small-3 columns">
		<ul data-magellan-expedition="fixed" class="side-nav" id="navbar">
			<li id="nav-title"><h5><a href="{{link}}">{{display_name}}/{{format_name}}</a> Interactions</h5></li>
          	<li data-magellan-arrival="summary"><a href="#summary">Interactors Summary</a></li>
			<li data-magellan-arrival="interactions"><a href="#interactions">Interactions</a></li>
			<li data-magellan-arrival="network"><a href="#network">Network Visualization</a></li>
			<li data-magellan-arrival="resources"><a href="#resources">Resources</a></li>
			<li data-magellan-arrival="references"><a href="#references">References</a></li>
		</ul>
	</nav>
	
	<div class="small-9 columns">  
		
<!-- Summary
================================================== -->
<section id="summary" data-magellan-destination="summary">
	<div class="page-header">
		<p>This page lists all genes/proteins that interact with {{display_name}}. See help for information about interaction data.</p>
		<h1>Interactors Summary</h1>
		<div id="venn_diagram"></div>
	
		<div class="button-bar">
			<h5>Analyze</h5>
			<ul class="button-group radius">
				<li><a href="" class="small button secondary">Physical</a></li>
				<li><a href="" class="small button secondary">Genetic</a></li>
				<li><a href="" class="small button secondary">Intersection</a></li>
				<li><a href="" class="small button secondary">All</a></li>
			</ul>
			<ul class="button-group radius">
				<li><a href="" class="small button secondary radius"><i class="icon-picture"></i> PNG</a></li>
			</ul>
		</div>
	</div>
</section>

<!-- Interactions
================================================== -->
<section id="interactions" data-magellan-destination="interactions">
	<div class="page-header">
		<h1>Interactions <span id='evidence_header'></h1>
		<span>Source: <a href="http://thebiogrid.org/" target="_blank">BioGRID</a></span>
		
		<span id='evidence_message'></span>
		<div id='evidence_wrapper'>
			<table class='table table-striped table-bordered table-condensed tablesorter' id='evidence_table' width="100%">
			<thead>
  			<tr>
  				<th></th>
  				<th>Interactor</th>
  				<th>Interactor</th>
  				<th>Type</th>
    			<th>Assay</th>
    			<th>Annotation</th>
    			<th>Action</th>
    			<th>Modification</th>
    			<th>Phenotype</th>
    			<th>Source</th>
    			<th>Reference</th>
    			<th>Note</th>
  			</tr>
  			</thead>
			</table>
        </div>
   </div>
</section>

<!-- Network Visualization
================================================== -->
<section id="network" data-magellan-destination="network">
	<div class="page-header">
		<h1>Network Visualization</h1>
		<strong>Filter Interactions by # of Experiments:</strong>
		<br></br>
		<div id="slider-range-min"></div>
		<br>
		<div id="cy" name="cy" style="width:100%;height:700px"></div>
        <span>Export:</span>
        <ul class="button-group radius">
        	<li><a class="small button secondary" onclick="vis.exportNetwork('png', '/download_graph/png')">png</a></li>
        	<li><a class="small button secondary" onclick="vis.exportNetwork('svg', '/download_graph/svg')">svg</a></li>
        	<li><a class="small button secondary" onclick="vis.exportNetwork('pdf', '/download_graph/pdf')">pdf</a></li>
        	<li><a class="small button secondary" onclick="vis.exportNetwork('xgmml', '/download_graph/xml')">xgmml</a></li>
        	<li><a class="small button secondary" onclick="vis.exportNetwork('graphml', '/download_graph/txt')">graphml</a></li>
        	<li><a class="small button secondary" onclick="vis.exportNetwork('sif', '/download_graph/txt', options={nodeAttr:'label', interactionAttr:'label'})">txt</a></li>
        </ul>
    </div>
</section>

<!-- Resources
================================================== -->
<section id="resources" data-magellan-destination="resources">
	<div class="page-header">
		<h1>Resources</h1>
		<ul id='resource_list'>
		</ul>
	</div>
</section>

<!-- References
================================================== -->
<section id="references" data-magellan-destination="references">
	<div class="page-header">
		<h1>References</h1>
		<ul id='reference_list'>
		</ul>
	</div>
</section>

</div>
</div>

<script>
	function set_up_resources(data) {
		resource_list = document.getElementById("resource_list");
		for (var i=0; i < data.length; i++) {
			var r = data[i];
			var span=document.createElement('span');
			span.innerHTML = r + ' | ';
			resource_list.appendChild(span);
		}
  	}
  	
  	function get_details(row) {
  		var details = row[9];
  		if(details != null) {
  			return '<strong>Note:</strong> ' + details + '<br>';
  	    }
  	    else {
  	    	return null;
  	    }
  	}
  	
  	function set_up_evidence_table(data) {  		
  		//Insert a 'details' column to the table  		
  		add_detail_column('genetic_evidence_table');
         
		//Set up genetic evidence table
		var options = {};
		options["bPaginate"] = true;
        options["oTableTools"] = table_tool_option('{{interaction_evidence_filename}}', true, '{{all_listname}}', 0, 2);
		options["sDom"] = '<"clear">lfrtipT';
		options["aaSorting"] = [[2, "asc"]];
        options["fnInitComplete"] = set_up_message_and_count("evidence_header", "evidence_message", "evidence_wrapper");
		options["fnDrawCallback"] = set_up_details(get_details);
		options["aoColumns"] = [{"bSortable":false}, {"bSearchable":false, "bVisible":false}, null, null, null, null, null, null, null, {"bSearchable":false, "bVisible":false}, null, {"bSearchable":false, "bVisible":false}]		
		options["aaData"] = data;
  				
  		var genetic_table = $('#evidence_table').dataTable(options);
  		genetic_table.on('filter', function(){
  			var visible_rows = genetic_table._('tr', {"filter": "applied"}).length;
  			if(visible_rows == 0) {
  				document.getElementById("ToolTables_evidence_table_0").className += " disabled";
  				document.getElementById("ToolTables_evidence_table_1").className += " disabled";
  				document.getElementById("ToolTables_evidence_table_2").className += " disabled";
  				document.getElementById("ToolTables_evidence_table_3").className += " disabled";
  				document.getElementById("ToolTables_evidence_table_4").className += " disabled";
  			}
  		});
  	}
	
	$(document).ready(function() {
	
		//Get resources
	  	$.getJSON("{{resource_link}}", set_up_resources);
	
		//Get evidence data
  		$.getJSON("{{interaction_evidence_table_link}}", function(data) {
			set_up_evidence_table(data['aaData']);
			set_up_references(data['reference'], 'reference_list');
    	});
    	
    	//Get evidence data
  		$.getJSON("{{interaction_overview_table_link}}", function(data) {
  			var r = data['venn'][0];
  			var s = data['venn'][1];
  			var x = data['venn'][2];
  			
			var stage = draw_venn_diagram("venn_diagram", r, s, x);
			stage.toDataURL({
       		 	width: 350,
        		height: 350,
        		callback: function(dataUrl) {
          			document.getElementById("save").href = dataUrl.replace("image/png", "image/octet-stream");
        		}
          	});
			
    		if(r == 0) {
    			document.getElementById("phys_and_gen").disabled = true; 
    			document.getElementById("phys").disabled = true; 
    		}
    		if(s == 0) {
    			document.getElementById("phys_and_gen").disabled = true; 
    			document.getElementById("gen").disabled = true; 
    		}
    		if(x == r+s+1) {
    			document.getElementById("phys_and_gen").disabled = true; 
    		}
    	});
	});
</script>

<script>
	function analyze_phys_and_gen() {
		var list_name = '{{both_listname}}';
		var bioents = [];
		
		var gen_bioents = {};
		var gen_table = $.fn.dataTable.fnTables(true)[0];
		var data = $(gen_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			gen_bioents[name] = true;
		}	
		
		var phs_table = $.fn.dataTable.fnTables(true)[1];
		var data = $(phs_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			if(name in gen_bioents) {
				bioents.push(name);
			}
			
		}	
		analyze(list_name, bioents);
	}
	
	function analyze_phys() {
		var list_name = '{{physical_listname}}';
		var bioents = [];

		var phs_table = $.fn.dataTable.fnTables(true)[1];
		var data = $(phs_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			bioents.push(name);
		}	
		analyze(list_name, bioents);
	}
	
	function analyze_gen() {
		var list_name = '{{genetic_listname}}';
		var bioents = [];

		var gen_table = $.fn.dataTable.fnTables(true)[0];
		var data = $(gen_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			bioents.push(name);
		}	
		analyze(list_name, bioents);
	}
	
	function analyze_phys_or_gen() {
		var list_name = '{{all_listname}}';
		var bioents = [];

		var gen_table = $.fn.dataTable.fnTables(true)[0];
		var data = $(gen_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			bioents.push(name);
		}	
		
		var phys_table = $.fn.dataTable.fnTables(true)[1];
		var data = $(phys_table).dataTable().fnGetData();
		for (var i=0,len=data.length; i<len; i++) { 
			var name_with_link = data[i][2];
			var name = name_from_link(name_with_link);
			bioents.push(name);
		}	
		analyze(list_name, bioents);
	}
	
</script>

<script src="../static/js/cytoscape/cytoscape.min.js"></script>	
<script src="../static/js/cytoscape/arbor.js"></script>	

<script>
var style = cytoscape.stylesheet()
	.selector('node')
	.css({
		'content': 'data(name)',
		'font-family': 'helvetica',
		'font-size': 14,
		'text-outline-width': 3,
		'text-outline-color': '#888',
		'text-valign': 'center',
		'color': '#fff',
		'width': 30,
		'height': 30,
		'border-color': '#fff'
	})
	.selector('edge')
	.css({
		'width': 2,
	})
	.selector("node[sub_type='FOCUS']")
	.css({
		'background-color': "#fade71",
		'text-outline-color': '#fff',
		'color': '#888',
	});
setup_cytoscape_vis('cy', "{{interaction_graph_link}}", style);
</script>
        

{% endblock body %}

<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../static/js/cytoscape/cxtmenu.js"></script>	
<script src="../static/js/cytoscape/cytoscape-edgehandles.min.js"></script>	
<script src="../static/js/cytoscape/cytoscape-panzoom.min.js"></script>	
<script src="../static/js/cytoscape/cytoscape-panzoom.css"></script>	

